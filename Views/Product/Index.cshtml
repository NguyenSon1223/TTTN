@* @model IEnumerable<dynamic>
@{
    ViewData["Title"] = "Danh s√°ch s·∫£n ph·∫©m";
}

<h2 class="text-center mb-4">Danh s√°ch s·∫£n ph·∫©m</h2>

<div class="text-end mb-3">
    <a asp-action="Create" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Th√™m s·∫£n ph·∫©m m·ªõi
    </a>
</div>

@if (Model == null || !Model.Any())
{
    <div class="alert alert-info text-center">
        Hi·ªán ch∆∞a c√≥ s·∫£n ph·∫©m n√†o ƒë∆∞·ª£c th√™m.
    </div>
}
else
{
    <div class="row row-cols-1 row-cols-md-3 g-4">
        @foreach (var item in Model)
        {
            <div class="col">
                <div class="card h-100 shadow-sm border-0">
                    <img src="~/images/@item.ImageUrl"
                         class="card-img-top"
                         alt="@item.Name"
                         style="height: 200px; object-fit: cover;" />

                    <div class="card-body">
                        <h5 class="card-title">@item.Name</h5>
                        <p class="card-text text-muted">
                            @item.Description
                        </p>
                        <p class="card-text">
                            <strong>Gi√°:</strong> @item.Price.ToString("N0") ƒë
                        </p>
                        <p class="card-text">
                            <strong>Danh m·ª•c:</strong>
                            <span class="badge bg-secondary">@item.CategoryName</span>
                        </p>
                    </div>

                    <div class="card-footer bg-white border-0 text-center">
                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning btn-sm me-2">
                            <i class="bi bi-pencil-square"></i> S·ª≠a
                        </a>
                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-danger btn-sm">
                            <i class="bi bi-trash"></i> X√≥a
                        </a>
                    </div>
                </div>
            </div>
        }
    </div>
} *@
@model IEnumerable<dynamic>
@{
    ViewData["Title"] = "Danh s√°ch s·∫£n ph·∫©m";
}

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold text-primary">üì¶ Danh s√°ch s·∫£n ph·∫©m</h2>
        <a asp-action="Create" class="btn btn-success px-4">‚ûï Th√™m s·∫£n ph·∫©m</a>
    </div>

    <!-- Th√¥ng b√°o -->
    @if (TempData["Message"] != null)
    {
        <div class="alert alert-success">@TempData["Message"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    @if (Model != null && Model.Any())
    {
        <div class="row">
            @foreach (var item in Model)
            {
                <div class="col-md-3 mb-4">
                    <div class="card shadow-sm border-0 h-100 rounded-4 product-card">
                        <div class="card-img-top text-center p-2" style="height: 220px;">
                            @if (!string.IsNullOrEmpty(item.ImageUrl))
                            {
                                <img src="~/img/@item.ImageUrl" alt="@item.Name" class="img-fluid rounded" style="max-height: 200px; object-fit: cover;" />
                            }
                            else
                            {
                                <img src="~/img/no-image.png" alt="No image" class="img-fluid rounded" style="max-height: 200px; object-fit: contain;" />
                            }
                        </div>

                        <div class="card-body d-flex flex-column justify-content-between">
                            <div>
                                <h5 class="card-title fw-bold text-dark">@item.Name</h5>
                                <p class="text-muted mb-2">
                                    <strong>Gi√°:</strong> @String.Format("{0:N0} VNƒê", item.Price)
                                </p>
                                <p class="small text-secondary mb-2" style="height: 40px; overflow: hidden;">
                                    @item.Description
                                </p>
                                <p class="badge bg-info text-dark px-3">
                                    Danh m·ª•c: @item.CategoryName
                                </p>
                            </div>

                            <div class="mt-3 d-flex justify-content-between">
                                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-warning btn-sm px-3"> S·ª≠a</a>
                                <button class="btn btn-danger btn-sm px-3" onclick="confirmDelete('@item.Id')"> X√≥a</button>
                            </div>
                            <form asp-controller="Cart" asp-action="Add" method="post" class="d-inline">
                                <input type="hidden" name="productId" value="@item.Id" />
                                <button type="submit" class="btn btn-success btn-sm">
                                    <i class="bi bi-cart-plus"></i> Th√™m v√†o gi·ªè
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="alert alert-info text-center">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o!</div>
    }
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function confirmDelete(id) {
            Swal.fire({
                title: "X√≥a s·∫£n ph·∫©m?",
                text: "B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y kh√¥ng?",
                icon: "warning",
                showCancelButton: true,
                confirmButtonText: "C√≥, x√≥a ngay!",
                cancelButtonText: "H·ªßy",
                confirmButtonColor: "#d33",
                cancelButtonColor: "#3085d6"
            }).then((result) => {
                if (result.isConfirmed) {
                    fetch(`/Product/Delete/${id}`, {
                        method: "POST"
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            Swal.fire("ƒê√£ x√≥a!", "S·∫£n ph·∫©m ƒë√£ ƒë∆∞·ª£c x√≥a.", "success").then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire("L·ªói!", data.message || "Kh√¥ng th·ªÉ x√≥a s·∫£n ph·∫©m.", "error");
                        }
                    })
                    .catch(err => Swal.fire("L·ªói!", "Kh√¥ng th·ªÉ k·∫øt n·ªëi t·ªõi server.", "error"));
                }
            });
        }
    </script>

    <style>
        .product-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

            .product-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            }
    </style>
}
